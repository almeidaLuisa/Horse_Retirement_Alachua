<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Register â€” Horse Retirement Alachua</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
	</head>
	<body class="bg-light">
		<div class="container py-5">
			<div class="row justify-content-center">
				<div class="col-12 col-md-8 col-lg-5">
					<div class="card shadow-sm">
						<div class="card-body p-4">
							<h1 class="h4 mb-3">Create your account</h1>
							<p class="text-muted mb-4">Sign up to view the full gallery.</p>

							<form id="registerForm">
								<div class="mb-3">
									<label for="regEmail" class="form-label">Email</label>
									<input class="form-control" id="regEmail" type="email" autocomplete="email" required />
								</div>

								<div class="mb-3">
									<label for="regPassword" class="form-label">Password</label>
									<input class="form-control" id="regPassword" type="password" autocomplete="new-password" minlength="6" required />
									<div class="form-text">Minimum 6 characters.</div>
								</div>

								<div class="text-danger small mb-3" id="registerError" style="display:none;"></div>
								<div class="text-success small mb-3" id="registerSuccess" style="display:none;"></div>

								<div class="d-grid gap-2">
									<button class="btn btn-primary" type="submit">Sign Up</button>
									<a class="btn btn-outline-secondary" href="home_page.html">Back to Home</a>
								</div>
							</form>

							<hr class="my-4" />
							<div class="text-center">
								<a href="login_page.html" class="link-secondary">Already have an account? Log in.</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			(function () {
				const form = document.getElementById('registerForm');
				const errorEl = document.getElementById('registerError');
				const successEl = document.getElementById('registerSuccess');
				const submitBtn = form.querySelector('button[type="submit"]');

				function setError(msg) {
					if (!msg) {
						errorEl.style.display = 'none';
						errorEl.textContent = '';
						return;
					}
					errorEl.style.display = 'block';
					errorEl.textContent = msg;
				}

				function setSuccess(msg) {
					if (!msg) {
						successEl.style.display = 'none';
						successEl.textContent = '';
						return;
					}
					successEl.style.display = 'block';
					successEl.textContent = msg;
				}

				function setLoading(isLoading) {
					submitBtn.disabled = isLoading;
					submitBtn.textContent = isLoading ? 'Signing up...' : 'Sign Up';
				}

				form.addEventListener('submit', async (e) => {
					e.preventDefault();
					setError('');
					setSuccess('');
					setLoading(true);

					const email = document.getElementById('regEmail').value.trim();
					const password = document.getElementById('regPassword').value;

					if (!email || !password) {
						setError('Email and password are required.');
						setLoading(false);
						return;
					}

					if (password.length < 6) {
						setError('Password must be at least 6 characters long.');
						setLoading(false);
						return;
					}

					try {
						const res = await fetch('/api/auth/register', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify({ email, password })
						});

						const data = await res.json().catch(() => ({}));
						if (!res.ok) {
							setError(data?.error || 'Registration failed.');
							setLoading(false);
							return;
						}

						setSuccess('Account created! Redirecting to login...');
						form.reset();
						
						// Redirect to login after 2 seconds
						setTimeout(() => {
							window.location.href = 'login_page.html';
						}, 2000);
					} catch (error) {
						setError('Network error. Is the server running?');
						setLoading(false);
					}
				});
			})();
		</script>
	</body>
</html>