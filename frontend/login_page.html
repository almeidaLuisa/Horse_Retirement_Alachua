<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Login â€” Horse Retirement Alachua</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
	</head>
	<body class="bg-light">
		<div class="container py-5">
			<div class="row justify-content-center">
				<div class="col-12 col-md-8 col-lg-5">
					<div class="card shadow-sm">
						<div class="card-body p-4">
							<h1 class="h4 mb-3">Log in</h1>
							<p class="text-muted mb-4">Log in to view the full gallery.</p>

							<form id="loginForm">
								<div class="mb-3">
									<label for="email" class="form-label">Email</label>
									<input class="form-control" id="email" type="email" autocomplete="email" required />
								</div>
								<div class="mb-3">
									<label for="password" class="form-label">Password</label>
									<input class="form-control" id="password" type="password" autocomplete="current-password" required />
								</div>

								<div class="text-danger small mb-3" id="loginError" style="display:none;"></div>

								<div class="d-grid gap-2">
									<button class="btn btn-primary" type="submit">Login</button>
									<a class="btn btn-outline-secondary" href="home_page.html">Back to Home</a>
								</div>
							</form>

							<!-- Register call -->
							<div class="text-center mt-4">
								<p class="text-muted mb-2">Don't have an account? Register</p>
								<a class="btn btn-outline-primary" href="register_page.html">Register</a>
							</div>

							<hr class="my-4" />
							<div class="text-center">
								<a href="register_page.html" class="link-secondary">Need an account? Sign up</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
			(function () {
				const form = document.getElementById('loginForm');
				const errorEl = document.getElementById('loginError');

				function setError(msg) {
					if (!msg) {
						errorEl.style.display = 'none';
						errorEl.textContent = '';
						return;
					}
					errorEl.style.display = 'block';
					errorEl.textContent = msg;
				}

				form.addEventListener('submit', async (e) => {
					e.preventDefault();
					setError('');

					const email = document.getElementById('email').value.trim();
					const password = document.getElementById('password').value;

					try {
						const res = await fetch('/api/auth/login', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify({ email, password })
						});

						const data = await res.json().catch(() => ({}));
						if (!res.ok) {
							setError(data?.error || 'Login failed.');
							return;
						}

						localStorage.setItem('authToken', data.token);
						window.location.href = 'home_page.html';
					} catch {
						setError('Network error. Is the server running?');
					}
				});
			})();
		</script>
	</body>
</html>